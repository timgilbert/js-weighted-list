var WeightedList=function(){function t(t){if(this.weights={},this.data={},this.length=0,this.hasData=!1,t="undefined"!=typeof t?t:[],!Array.isArray(t))throw new Error('Unknown object "'+t.toString()+'" passed to WeightedList constructor! (Expected array or nothing)');for(var e=0;e<t.length;e++)this.push(t[e])}function e(t,e,h){this.weight=t,this.value=e,this.total=h}function h(t){this.heap=[null];for(var h=0;h<t.length;h++){var i=t[h][1],r=t[h][0];this.heap.push(new e(i,r,i))}for(h=this.heap.length-1;h>1;h--)this.heap[h>>1].total+=this.heap[h].total}return t.prototype={push:function(t){var e,h,i;if(Array.isArray(t)){if(e=t[0],h=t[1],i=t[2],"undefined"==typeof e)throw new Error("In WeightedList.push([ ... ]), need at least two elements");if("undefined"==typeof h)throw new Error("In array passed to WeightedList.push([ ... ]), second element is undefined!")}else{if("object"!=typeof t)throw new Error('WeightedList.push() passed unknown type "'+typeof t+'", expected [key, weight] or {"key": k, "weight": w}');if(e=t.key,h=t.weight,i=t.data,"undefined"==typeof e)throw new Error("In WeightedList.push({ ... }), no {'key': 'xyzzy'} pair found");if("undefined"==typeof h)throw new Error("In array passed to WeightedList.push({ ... }), no {'weight': 42} pair found")}return this._push_values(e,h,i)},_push_values:function(t,e,h){if(this.weights[t])throw new Error("");if("number"!=typeof e)throw new Error("Weight must be numeric (got "+e.toString()+")");if(0>=e)throw new Error("Weight must be >= 0 (got "+e+")");this.weights[t]=e,"undefined"!=typeof h&&(this.hasData=!0,this.data[t]=h),this.length++},addWeight:function(t,e){this.weights[t]+=e},peek:function(t,e){if("undefined"==typeof t&&(t=1),e=!!e,this.length-t<0)throw new Error("Stack underflow! Tried to retrieve "+t+" element"+(1===t?"":"s")+" from a list of "+this.length);for(var h=this._buildWeightedHeap(),i=[],r=0;t>r;r++){var n=h.pop();this.hasData?i.push({key:n,data:this.data[n]}):i.push(n),e&&(delete this.weights[n],delete this.data[n],this.length--)}return i},shuffle:function(){return this.peek(this.length)},pop:function(t){return this.peek(t,!0)},_buildWeightedHeap:function(){var t=[];for(var e in this.weights)this.weights.hasOwnProperty(e)&&t.push([e,this.weights[e]]);return new h(t)}},h.prototype={pop:function(){for(var t=this.heap[1].total*Math.random(),e=1;t>this.heap[e].weight;)t-=this.heap[e].weight,e<<=1,t>this.heap[e].total&&(t-=this.heap[e].total,e++);var h=this.heap[e].value,i=this.heap[e].weight;for(this.heap[e].weight=0;e>0;)this.heap[e].total-=i,e>>=1;return h}},t}();
